#Push

* 推送分为两大模块: 在线推送(30分钟内)和活跃推送(30天内上线过)
* 推送消息目标类型分为两类: 指定目标用户群, 所有用户(待实现)
* 推送系统维护活跃用户表(更新online和offline, 30天offline则自动删除该用户), 该表可以由外部其它业务访问
* 业务层推送前, 需要将自己的推送目标用户和活跃用户表关联过滤出推送目标群用户(不在活跃用户表中的推送目标直接丢弃, 或随机保留部分非活跃用户)
* 推送服务器在收到业务层的推送请求时, 先对推送目标分两类: 在线用户和离线用户(30分钟). 对离线用户直接存储到db的待发表中; 对iOS用户此时直接推送APNS, 且仅推送一次, 记录iOS推送状态
* 推送消息被存储到db的待发表时, 实体和关系分两表存储,避免了重复消息实体的存储冗余开销
* 对在线用户(30分钟内)的推送, 只有在超时后offline才将未发送成功的消息存储到db的待发表中. 30分钟内的断线重连, 自动重推消息. 如果一个消息对online用户发送后, 30s内客户端还不回ACK消息, 则主动断开该链路(这样可以触发客户端断线重连的重推逻辑)
* 用户上线online(即断开30分钟以上)时, 需要从db的待发表取出并删除关系, 这些消息重新走在线用户(30分钟内)推送逻辑
* db的待发表中的实体和关系自动过期删除(30天)
* 客户端需实现消息冗余过滤功能(特别是iOS), 收到重复推送消息时,不处理
* 推送消息包含以下属性: i(全局唯一msgId), t(时间戳), c(消息类别), b(消息体), p(iOS推送title, 仅在APNS推送时包含)

